$((()=>{"use strict";PNotify.prototype.options.delay=2e3;let e=[];const t=()=>{$.ajax({method:"POST",url:"/integrations/greenhouse/get_jobs"}).done((e=>{let t="";for(let o=0;o<e.length;o++){const a=e[o];t+='<option value="'+a.id+'">'+a.name+"</option>"}$("#export-greenhouse-job").html(t)}))},o=()=>{const t=$("#export-greenhouse-prospect-pools").val(),o=e.filter((e=>e.id===t))[0];if(o){let e="<option value='0'>No stage</option>";for(let t=0;t<o.stages.length;t++){const a=o.stages[t];e+='<option value="'+a.id+'">'+a.name+"</option>"}$("#export-greenhouse-prospect-pools-stage").html(e)}},a=()=>{$.ajax({method:"POST",url:"/integrations/greenhouse/get_pools"}).done((t=>{let a="";for(let e=0;e<t.length;e++){const o=t[e];a+='<option value="'+o.id+'">'+o.name+"</option>"}e=t,$("#export-greenhouse-prospect-pools").html(a),o()}))},n=()=>{window.setTimeout((()=>{$.get("/profile/me",(e=>{e.mixpanel_event&&window?.mixpanel?.track(e?.mixpanel_event?.name,e?.mixpanel_event?.details)}))}),5e3)};$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),$(".select2").select2(),$(".more-details").on("click",(function(e){e.preventDefault();const t=$(this),o=t.parent(),a=$(o.find(".less-details")[0]),n=$(o.find(".more-details-container")[0]);a.show(),n.show(),t.hide()})),$(".less-details").on("click",(e=>{e.preventDefault();const t=$(this),o=t.parent(),a=$(o.find(".more-details")[0]),n=$(o.find(".more-details-container")[0]);a.show(),n.hide(),t.hide()})),$("#select-all-leads").on("change",(function(){const e=$(this).is(":checked");$(".select-lead").prop("checked",e)})),$("#filter-btn").on("click",(e=>{e.preventDefault(),$("#filter-leads-modal").modal("show")})),$(".ui-popover.lead-select").webuiPopover({url:$(".lead-select-content"),animation:"pop",placement:"bottom",width:170,padding:!1}),$(".ui-popover.assign-leads-select").webuiPopover({url:$(".assign-leads-select-content"),animation:"pop",placement:"bottom",padding:!1,width:200}),$(".ui-popover.manage-folder-select").webuiPopover({url:$(".manage-folder-select-content"),animation:"pop",placement:"bottom",padding:!1}),$(".ui-popover.manage-status-select").webuiPopover({url:$(".manage-status-select-content"),animation:"pop",placement:"bottom",padding:!1}),$(".ui-popover.status-select").webuiPopover({url:$(".status-select-content"),animation:"pop",placement:"bottom",padding:!1,onShow:e=>{const t=$(e);$(t.find(".search").eq(0)).focus()}}),$(".ui-popover.folder-select").webuiPopover({url:$(".folder-select-content"),animation:"pop",placement:"bottom",padding:!1,onShow:e=>{const t=$(e);$(t.find(".search").eq(0)).focus()}}),$(".ui-popover.folder-assign-select").webuiPopover({url:$(".folder-assign-content"),animation:"pop",placement:"left",height:200,width:250,multi:!0,padding:!1,onShow:()=>{WebuiPopovers.hide(".ui-popover.status-assign-select")}}),$(".ui-popover.status-assign-select").webuiPopover({url:$(".status-assign-content"),animation:"pop",placement:"left",height:200,width:200,multi:!0,padding:!1,onShow:()=>{WebuiPopovers.hide(".ui-popover.folder-assign-select")}});$("#exportLeadModal").on("show.bs.modal",(()=>{$("#export-lead-type").val("all");const e=new URLSearchParams(window.location.search).get("selectedFolder");e&&($("#export-lead-type").val("folder"),$("#export-folder-form-group").show(),$("#selected-export-folder-id").val(e),$("#export-folder").val(e)),$(".select-lead:checked").length>0&&($("#export-lead-type").val("selected"),$("#export-folder-form-group").hide())})),$(".ui-popover.export-select").on("click",(()=>{window.ContactOut.integrationStatus.greenhouse&&(t(),a()),window.ContactOut.integrationStatus.lever&&D(),$("#exportLeadModal").modal("show")})),$(".ui-popover.export-folder").webuiPopover({url:$(".folder-export-content"),animation:"pop",placement:"left",padding:!1,width:170,multi:!0}),$(".export-selected-folder").on("click",(function(){const e=$(this).data("folder");$("#selected-export-folder-id").val(e),$("#export-folder-form").submit(),n()})),$(".export-selected-btn").on("click",(function(e){gtag("event","export leads",{event_category:"pipeline"});const t=$("#check-all").is(":checked");let o;const a=$(".select-lead:checked");if(o=[],a.each((function(){o.push($(this).data("lead"))})),0===o.length)return e.preventDefault(),void new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:"Please select leads.",delay:1e3});o=o.join(";"),$("#export-leads-serialized").val(o),0!==o.length||t?($("#export-form").submit(),n()):e.preventDefault()})),$(".export-all-btn").on("click",(()=>{$("#export-all-form").submit(),n()})),$("#delete-selected-leads-btn").on("click",(()=>{const e=$(".select-lead:checked");let t=[];e.each((function(){t.push($(this).data("lead"))})),0!==t.length?$.confirm({title:"Delete selected leads?",content:"Are you sure you want to delete the selected leads?",buttons:{confirm:()=>{t=t.join(";"),$("#delete-leads-serialized").val(t),$("#delete-selected-leads").submit()},cancel:()=>{}}}):new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:"Please select leads.",delay:1e3})}));const l=$("#export-lead-type"),s=$("#export-folder-form-group");l.on("change",(()=>{"folder"===l.val()?s.show():s.hide()}));const r=$("#export-lead-to"),i=$("#export-greenhouse-type-form-group"),d=$("#export-greenhouse-type"),c=$("#export-greenhouse-jobs-form-group"),p=$("#export-greenhouse-prospect-pools-form-group"),u=$("#export-greenhouse-connect-form-group"),f=$("#export-salesforce-connect-form-group"),h=$("#export-lever-connect-form-group"),m=$("#export-greenhouse-connect-loading-form-group"),g=$("#modal-export-leads-btn");d.on("change",(()=>{"1"===d.val()?(c.show(),p.hide()):(p.show(),c.hide())}));const v=$("#export-lever-type-form-group"),w=$("#export-lever-job-postings-form-group"),x=$("#export-lever-postings"),y=$("#export-lever-type");y.on("change",(function(){"specific_job"===$(this).val()?(v.show(),w.show()):(x.val(null),w.hide())})),r.on("change",(()=>{const e=r.val();$(".connect-status-prompt").hide(),$(".save-to-form-group").hide(),g.show(),"greenhouse"!==e?("salesforce"===e&&(window.ContactOut.integrationStatus.salesforce||(f.show(),g.hide())),"lever"===e&&(window.ContactOut.integrationStatus.lever?v.show():(v.hide(),h.show(),g.hide())),"csv"===e&&(w.hide(),x.val(null),y.val("candidate")),i.hide(),c.hide()):window.ContactOut.integrationStatus.greenhouse?(c.show(),i.show(),p.hide()):(u.show(),g.hide())}));const b=$("#export-folder"),k=$("#export-greenhouse-job"),P=$("#export-greenhouse-prospect-pools"),N=$("#export-greenhouse-prospect-pools-stage");g.on("click",(()=>{const e=l.val(),t=b.val(),o=r.val(),a=k.val(),s=P.val(),i=d.val(),c=N.val(),p=$(".select-lead:checked");let u=[];if(p.each((function(){u.push($(this).data("lead"))})),u=u.join(";"),"csv"===o)return"selected"===e?$(".export-selected-btn").click():"folder"===e?($("#selected-export-folder-id").val(t),$("#export-folder-form").submit()):"all"===e&&$(".export-all-btn").click(),n(),void $("#exportLeadModal").modal("hide");"salesforce"===o?($("#export-salesforce-leads-type").val(e),$("#export-salesforce-leads-folder").val(t),$("#export-salesforce-leads-leadIds").val(u),$("#export-salesforce-leads-form").submit(),new PNotify({styling:"bootstrap3",title:"Export data",type:"success",text:"Please wait while we export your data.",hide:!1})):"lever"===o?($("#export-lever-leads-type").val(e),$("#export-lever-leads-folder").val(t),$("#export-lever-leads-leadIds").val(u),$("#export-lever-leads-form").submit()):($("#export-greenhouse-leads-type").val(e),$("#export-greenhouse-leads-folder").val(t),$("#export-greenhouse-leads-job").val(a),$("#export-greenhouse-type-value").val(i),$("#export-greenhouse-leads-prospect-pool").val(s),$("#export-greenhouse-leads-prospect-pool-stage").val(c),$("#export-greenhouse-leads-leadIds").val(u),$("#export-greenhouse-leads-form").submit(),new PNotify({styling:"bootstrap3",title:"Export data",type:"success",text:"Please wait while we export your data.",hide:!1})),n(),$("#exportLeadModal").modal("hide")})),P.on("change",(()=>{o()})),$(".authorize-url-link").on("click",(()=>{$.ajax({method:"GET",url:"/integrations/connect/greenhouse/url"}).done((e=>{window.open(e.url,"Greenhouse","width=1000,height=500"),u.hide(),m.show();const o=setInterval((()=>{$.ajax({method:"GET",url:"/integrations/connect/greenhouse/status"}).done((e=>{e.connected&&(c.show(),m.hide(),clearInterval(o),t(),a())}))}),1e3)}))}));const D=()=>{$.ajax({method:"GET",url:"/api/ats-integrations/lever/postings"}).done((function(e){let t="";const o=[];e.data.forEach((function(e){o[e.categories.location]=[]})),e.data.forEach((function(e){o[e.categories.location].push(e)})),Object.keys(o).forEach((function(e){t+=`<optgroup label="${e}">`,o[e].forEach((function(e){t+=`<option value="${e.id}">${e.text}</option>`})),t+="</optgroup>"})),x.html(t)}))}})),$((function(){$("input[type=radio][name=lead_type]").change((function(){$(".folder-select").val("0"),"1"==this.value?($(".my-folder-row").show(),$(".team-folder-row").hide()):"2"==this.value&&($(".my-folder-row").hide(),$(".team-folder-row").show())}));var e={valueNames:["item"]},t=new List("folder-filter-list",e);t.on("updated",(function(e){0===e.matchingItems.length?$("#folder-filter-list .empty-list-message").show():$("#folder-filter-list .empty-list-message").hide()}));var o=new List("status-filter-list",e);o.on("updated",(function(e){0===e.matchingItems.length?$("#status-filter-list .empty-list-message").show():$("#status-filter-list .empty-list-message").hide()}));var a=new List("folder-assign-list",e);a.on("updated",(function(e){0===e.matchingItems.length?$("#folder-assign-list .empty-list-message").show():$("#folder-assign-list .empty-list-message").hide()}));var n=new List("status-assign-list",e);n.on("updated",(function(e){0===e.matchingItems.length?$("#status-assign-list .empty-list-message").show():$("#status-assign-list .empty-list-message").hide()})),$("#folder-select-form").on("submit",(function(e){if(t.matchingItems.length>0){var o=$(t.matchingItems[0].elm);$(o.find("a").eq(0)).trigger("click"),e.preventDefault()}})),$("#status-select-form").on("submit",(function(e){if(o.matchingItems.length>0){var t=$(o.matchingItems[0].elm);$(t.find("a").eq(0)).trigger("click"),e.preventDefault()}})),$("#create-assign-folder-form").on("submit",(function(e){$(this);if(a.matchingItems.length>0){var t=$(a.matchingItems[0].elm);return $(t.find("a").eq(0)).trigger("click"),void e.preventDefault()}var o=$(".select-lead:checked"),n=[];if(o.each((function(){n.push($(this).data("lead"))})),0===n.length)return e.preventDefault(),void new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:"Please select leads.",delay:1e3});var l=n.join(";");$("#create-assign-folder-form .selected_leads").val(l)})),$("#create-assign-status-form").on("submit",(function(e){$(this);if(n.matchingItems.length>0){var t=$(n.matchingItems[0].elm);return $(t.find("a").eq(0)).trigger("click"),void e.preventDefault()}var o=$(".select-lead:checked"),a=[];if(o.each((function(){a.push($(this).data("lead"))})),0===a.length)return e.preventDefault(),void new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:"Please select leads.",delay:1e3});var l=a.join(";");$("#create-assign-status-form .selected_leads").val(l)}))})),$((function(){"use strict";function e(e){var t=e.data("id"),o=e.data("profile"),a=e.data("vanity"),l=$(".new-note-text-"+t);n(l.val(),o,a),l.val("")}function t(e){e.data("id"),e.data("vanity"),e.data("content");e.on("click",(function(t){t.preventDefault();var a=e.parent().parent(),n=$(a.find(".content-area").eq(0)),l='<div class="input-group input-group-sm"><input type="text" class="form-control note-edit-text" value="'+e.data("content")+'" /><span class="input-group-btn"><button class="btn btn-sm btn-flat btn-primary note-edit-submit">edit</button><button class="btn btn-sm btn-flat btn-danger note-edit-cancel">cancel</button></span></div>';n.html(l),function(e,t){var a=$(t.find(".note-edit-text").eq(0)),n=$(t.find(".note-edit-submit").eq(0)),l=$(t.find(".note-edit-cancel").eq(0)),s=e.data("id");a.focus(),a.on("keyup",(function(n){if(13===n.which){var l=a.val();o(s,l,t,e)}})),n.on("click",(function(n){n.preventDefault();var l=a.val();o(s,l,t,e)})),l.on("click",(function(o){o.preventDefault();var a=e.data("content");t.html(a)}))}(e,n)}))}function o(e,t,o,a){NProgress.start(),$.ajax({url:"/api/notes/"+e,method:"PUT",data:{content:t}}).done((function(){o.html(t),a.data("content",t)})).fail((function(){})).always((function(){NProgress.done()}))}function a(e){var t=e.data("id"),o=e.data("vanity");e.on("click",(function(a){a.preventDefault(),NProgress.start(),$.ajax({url:"/api/notes",method:"DELETE",data:{noteId:t}}).done((function(){e.parent().parent().remove(),""===$("#notes-modal .notes-container").html()&&$("#notes-modal .no-notes-message").show(),function(e){var t=$(".link-"+e),o=parseInt(t.data("count"))-1;t.data("count",o),t.text("notes("+o+")")}(o),new PNotify({styling:"bootstrap3",title:"Success",type:"success",text:"Successfully deleted note"})})).fail((function(){new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:"An error occurred while deleting the note. Please try again later.",delay:1e3})})).always((function(){NProgress.done()}))}))}function n(e,o,n){e.trim().length&&(NProgress.start(),$.ajax({url:"/api/notes",method:"POST",data:{profile:o,content:e}}).done((function(e){if(400!==e.status){window.mixpanel?.track?.("add_note",{}),new PNotify({styling:"bootstrap3",title:"Success",type:"success",text:"Successfully added new note"}),function(e){var t=$(".link-"+e),o=parseInt(t.data("count"))+1;t.data("count",o),t.text("notes("+o+")")}(n);var o=e.note.content.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),l='<div class="d-flex"><b class="mr-10 author">'+e.note.author+' :</b><span class="content-area">'+o+'</span><span class="mr-10 date">'+e.note.created_at+'</span><div><a href="#" class="edit-note-btn mr-10"data-vanity="'+n+'"data-content="'+o+'"data-id="'+e.note.key+'"><i class="fa fa-pencil"></i></a><a href="#" class="delete-note-btn"data-vanity="'+n+'"data-id="'+e.note.key+'"><i class="fa fa-times-circle-o"></i></a></div></div>';$(".notes-content-"+n).prepend(l),a($(".notes-content-"+n+" .delete-note-btn").eq(0)),t($(".notes-content-"+n+" .edit-note-btn").eq(0))}})).fail((function(){new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:"An error occurred while processing your request. Please try again later.",delay:1e3})})).always((function(){NProgress.done()})))}$(".show-notes-btn").on("click",(function(e){e.preventDefault(),gtag("event","show notes",{event_category:"pipeline"});var t=$(this).parent().parent().parent(),o=$(t.find(".less-details")[0]),a=$(t.find(".more-details-container")[0]);a.is(":hidden")?(o.show(),a.show()):(o.hide(),a.hide())})),$(".delete-note-btn").each((function(e,t){a($(t))})),$(".edit-note-btn").each((function(e,o){t($(o))})),$(".ui-popover.new-note-btn").each((function(e,t){var o=$(".new-note-content").clone(),a=$(t);a.webuiPopover({url:o,animation:"pop",placement:"auto",onShow:function(e){var t=$(e.find(".add-note-btn")[0]),o=$(e.find("textarea")[0]);t.on("click",(function(){n(o.val(),a.data("profile"),a.data("vanity")),o.val(""),a.webuiPopover("hide")}))}})})),$(".new-note-text").keyup((function(t){13===t.which&&e($(this).next())})),$(".new-note-btn").on("click",(function(){e($(this))})),$("#notes-modal .load-more").on("click",(function(){var e,t;noteCurrentPage+=1,e=noteCurrentProfile,t=noteCurrentPage,$("#notes-modal .loader").show(),$.ajax({url:"/api/notes/get",method:"POST",data:{profile:e,page:t}}).done((function(e){var t="",o=e.data.data;console.log(o);for(var n=0;n<o.length;n++)t+='<li><p class="note">'+o[n].content+'</p><div class="info"><span class="author">'+o[n].author+"</span>",o[n].author===window.ContactOut.authEmail?t+='<span class="delete"><a href="#" data-id="'+o[n].key+'"> delete</a></span>':t+='<span class="delete"></span>',t+='<span class="date">'+o[n].created_at+"</span></div></li>";$("#notes-modal .notes-container").append(t),$("#notes-modal .delete a").each((function(){a($(this))})),e.data.total?$("#notes-modal .notes-container").show():($("#notes-modal .notes-container").hide(),$("#notes-modal .no-notes-message").show()),e.data.next_page_url?($("#notes-modal .load-more").show(),$("#notes-modal .no-notes-message").hide(),$("#notes-modal .no-notes-message h4").html("No more notes to display")):$("#notes-modal .load-more").hide()})).fail((function(e){})).always((function(){$("#notes-modal .loader").hide()}))})),$("#notes-modal #add-note-button").on("click",(function(){$("#notes-modal .note-content").val()}))})),$((function(){function e(e){var t=e.data("lead"),o=e.data("folder");NProgress.start(),$.ajax({url:"/users/folders/remove",data:{lead:t,folder:o},dataType:"json",type:"DELETE"}).done((function(t){console.log(t),new PNotify({styling:"bootstrap3",title:"Success",type:"success",text:t.success}),e.parent().remove()})).always((function(){NProgress.done()}))}$("#updateFolderModal .folder-select").change((function(){var e=$(this),t=$(e.find("option:selected"));if(""!==t.val()){$(".folder-edit-control").show();var o=!!t.data("shared")&&1===t.data("shared"),a=t.text();a=void 0===t.data("shared")?"":a;var n=$("#updateFolderModal");$(n.find(".folder-name")).val(a),o?$(n.find(".shared")).attr("checked","checked"):$(n.find(".shared")).removeAttr("checked")}else $(".folder-edit-control").hide()})),$(".folder-edit-btn").on("click",(function(e){e.preventDefault(),$(".ui-popover.folder-assign-select").webuiPopover("hide"),$(".ui-popover.assign-leads-select").webuiPopover("hide"),$(".ui-popover.folder-select").webuiPopover("hide");var t=$(this),o=t.data("folder"),a=t.data("folderName"),n=t.data("shared"),l=t.data("default");$("#updateFolderModal .folder-id").val(o),$("#updateFolderModal .folder-name").val(a),$("#updateFolderModal .folder-delete-btn").data("folder",o),l?$("#updateFolderModal .default").attr("checked","checked"):$("#updateFolderModal .default").removeAttr("checked"),n?$("#updateFolderModal .shared").attr("checked","checked"):$("#updateFolderModal .shared").removeAttr("checked"),$("#updateFolderModal").modal("show")})),$(".create-folder-modal-btn").on("click",(function(e){e.preventDefault(),$(".ui-popover.folder-assign-select").webuiPopover("hide"),$(".ui-popover.assign-leads-select").webuiPopover("hide"),$("#createFolderModal").modal("show")})),$(".folder-delete-btn").on("click",(function(e){e.preventDefault();var t=$(this).data("folder");$.confirm({title:"Confirm",content:'<p>Are you sure you want to delete this folder?</p><label><input type="checkbox" checked id="delete-all-leads-checkbox" /> Delete all leads in this folder.</label>',buttons:{confirm:{title:"Delete folder",action:function(){var e=$("#delete-all-leads-checkbox").is(":checked")?1:0;$("#deleteFolderModal .folder-id").val(t),$("#deleteFolderModal .delete-leads").val(e),$("#deleteFolderModal form").submit()}},cancel:function(){}}})})),$(".assign-to-folder").on("click",(function(t){t.preventDefault(),gtag("event","set folder",{event_category:"pipeline"});var o=$(this),a=o.data("folder"),n=o.data("folder-name"),l=o.data("shared"),s=$(".select-lead:checked"),r=[];s.each((function(){r.push($(this).data("lead"))})),0!==r.length?($(".ui-popover.folder-assign-select").webuiPopover("hide"),NProgress.start(),$.ajax({method:"POST",url:"/users/folders/assign",data:{folder:a,leads:r}}).done((t=>{window.mixpanel?.track?.(t?.mixpanel_event?.name,t?.mixpanel_event?.details);var o=' <i class="fa fa-folder"></i>';l&&(o=' <i class="fa fa-folder-open text-green"></i>'),t.attachedLeads.forEach((function(t){var l=$(".folder-section-"+t),s="<span>"+o+" "+n+' <a href="#" class="remove-lead-assignment"data-folder="'+a+'"data-lead="'+t+'"> <i class="fa fa-times-circle-o"></i></a></span>';l.append(s),l.find(".remove-lead-assignment").off().on("click",(function(t){t.preventDefault(),e($(this))}))})),new PNotify({styling:"bootstrap3",title:"Success",type:"success",text:t.success})})).fail((function(e){new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:response.error,delay:1e3})})).always((function(){NProgress.done()}))):new PNotify({styling:"bootstrap3",title:"Error",type:"error",text:"Please select leads.",delay:1e3})})),$(".remove-lead-assignment").on("click",(function(t){t.preventDefault(),e($(this))}))}));
